#include <LiquidCrystal.h>
#include <SoftwareSerial.h>
#include <string.h>
LiquidCrystal lcd(13,12,11,10,9,8);   //RS,EN,D4,D5,D6,D7

#define Sw0 3

int sensor=A4;
int sensor1=A5;

#define L1 4
#define L2 5
#define L3 6
#define L4 7
int motor1Pin1 = A0; // MOTROR PIN 1
int motor1Pin2 = A1; // MOTROR PIN 2
int motor2Pin1 = A2; // MOTROR PIN 3
int motor2Pin2 = A3; // MOTROR PIN 4
int count = 0,S,S1,S2;      //integer for storing character of ID
char input[12];                   //memory for storing 12 characters of ID

int temp_read,ecg_read;
void setup()
{
Serial.begin(9600);//serial communication enabling by 9600 baud rate
lcd.begin(16,2);  
lcd.print(" WELCOME TO THE");
lcd.setCursor(0,1);
lcd.print("    PROJECT     ");
delay(2000);
}
void loop()
{    
lcd.clear();
CheckTemp();
delay(1000);
CheckEcg();
delay(1000);
int temp1=digitalRead(L1);
int temp2=digitalRead(L2);
int temp3=digitalRead(L3);
int temp4=digitalRead(L4);
if(temp1==1 && temp2==1 && temp3==1 && temp4==1)
{
Stop(); 
lcd.clear();  
lcd.print("STOP");
delay(1000);
}
if(temp1==1 && temp2==1 && temp3==1 && temp4==0)
{

lcd.clear();  
lcd.print("FRONT");
delay(1000);
Forward();
}
else if(temp1==1 && temp2==1 && temp3==0 && temp4==1)
{

lcd.clear();  
lcd.print("BACK");
Back();
delay(1000); 
Stop(); 
}
else if(temp1==1 && temp2==0 && temp3==1 && temp4==1)
{

lcd.clear();  
lcd.print("LEFT ");
Right();
delay(1000); 
Stop();  
}
else if(temp1==0 && temp2==1 && temp3==1 && temp4==1)
{
lcd.clear();  
lcd.print("RIGHT ");
Left();
delay(1000); 
Stop();  
}
input[count] = Serial.read();//storing 12 characters one by one
count++;
lcd.print(input[count]);//showing 12 characters on LCD one by one
if (count==12)
{
if(!(strncmp(input,"3600A4B99DB6",10)))
{
S=1;
lcd.clear();
lcd.setCursor(0,0);
lcd.print("  AREA 1");
delay(1000);
}
if(!(strncmp(input,"3600A4ACE0DE",10)))
{
S=2;
lcd.clear();
lcd.setCursor(0,0);
lcd.print("  AREA 2");
delay(1000);
}
}
if(!digitalRead(Sw0))
{
lcd.clear();
lcd.print("ACCIDENT OCCURRED ");
delay(2000);
lcd.clear();
lcd.print("SENDING SMS1 ");
Serial.print("AT+CMGS=");
Serial.print('"');
Serial.print("+919010155854");    //mobile no. for SMS alert
Serial.println('"');
Serial.print("YOUR VEHICLE GETS AN ACCIDENT IN THIS LOCATION:");
if(S==0)
{
Serial.println("AREA 0");    
}
if(S==1)
{
Serial.println("AREA 1");   
delay(500); 
}
if(S==2)
{
Serial.println("AREA 2");    
}
Serial.write(26);
delay(2000);
lcd.clear();
lcd.print("SMS SENT1");
delay(1000);
lcd.clear();
lcd.print("VEHICLE STOP");
delay(2000);
while(1);
}      
} 
void CheckTemp()
{
lcd.begin(16,2); 
lcd.setCursor(0,0);
lcd.print("TEMP");
temp_read=analogRead(sensor); // reads the sensor output (temparature)
temp_read=temp_read*5;             // converts the sensor reading to temperature
temp_read=temp_read/10;           // adds the decimal point
lcd.setCursor(0,1);   // sets cursor at column 0 row 1
lcd.print(temp_read);      // prints temperature in degree Celsius
delay(500);
if(temp_read>40)
{
lcd.setCursor(0,1);
lcd.print("HIGH");
delay(1000);
delay(100);
lcd.clear();
lcd.setCursor(0,0);
lcd.print("SENDING SMS");
Serial.println("AT+CMGF=1");                    //To send SMS in Text Mode
delay(1000);
Serial.println("AT+CMGS=\"+919059688304\"\r");  // change to the phone number you using 
delay(1000);
Serial.println("HIGH TEMPERATURE DETECTED ");    //the content of the message
delay(200);
Serial.println((char)26);                       //the stopping character
delay(4000);
}
}
void CheckEcg()
{
lcd.setCursor(6,0);
lcd.print("SMOKE");
ecg_read=analogRead(sensor1); // reads the sensor output (temparature)
ecg_read=ecg_read*5;             // converts the sensor reading to temperature
ecg_read=ecg_read/10;           // adds the decimal point
lcd.setCursor(6,1);   // sets cursor at column 0 row 1
lcd.print(ecg_read);      // prints temperature in degree Celsius
delay(1000);
if(ecg_read>40)
{
lcd.setCursor(6,1);
lcd.print("HIGH");
delay(1000);
lcd.clear();
lcd.setCursor(0,0);
lcd.print("SENDING SMS");
Serial.println("AT+CMGF=1");                    //To send SMS in Text Mode
delay(1000);
Serial.println("AT+CMGS=\"+919059688304\"\r");  // change to the phone number you using 
delay(1000);
Serial.println("HIGH SMOKE DETECTED ");    //the content of the message
delay(200);
Serial.println((char)26);                       //the stopping character
delay(4000);
}
}
void Left()
{
digitalWrite(motor1Pin1, LOW); 
digitalWrite(motor1Pin2, HIGH);
digitalWrite(motor2Pin1, LOW);
digitalWrite(motor2Pin2, HIGH);
}
void Right()
{
digitalWrite(motor1Pin1, HIGH); 
digitalWrite(motor1Pin2, LOW);
digitalWrite(motor2Pin1, HIGH);
digitalWrite(motor2Pin2, LOW);
}
void Forward()
{
digitalWrite(motor1Pin1, LOW); 
digitalWrite(motor1Pin2, HIGH);
digitalWrite(motor2Pin1, HIGH);
digitalWrite(motor2Pin2, LOW);
}
void Back()
{
digitalWrite(motor1Pin1, HIGH); 
digitalWrite(motor1Pin2, LOW);
digitalWrite(motor2Pin1, LOW);
digitalWrite(motor2Pin2, HIGH);
}
void Stop()
{ 
digitalWrite(motor1Pin1, LOW); 
digitalWrite(motor1Pin2, LOW);
digitalWrite(motor2Pin1, LOW);
digitalWrite(motor2Pin2, LOW);
}
